<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Register | CivicConnect</title>

    <!-- Bootstrap utilities only -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(180deg, #e9fbfb, #9fe7e5);
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }

        .auth-card {
            max-width: 460px;
            width: 100%;
            padding: 30px 34px;
            border-radius: 22px;
            background: #ffffff;
            box-shadow: 0 25px 45px rgba(0, 0, 0, 0.15);
        }

        .logo {
            width: 140px;
            display: block;
            margin: 0 auto 14px;
        }

        h3 {
            text-align: center;
            font-weight: 600;
            margin-bottom: 6px;
            color: #1f1f1f;
        }

        .subtitle {
            text-align: center;
            font-size: 13.5px;
            color: #555;
            margin-bottom: 22px;
        }

        .form-label {
            font-weight: 500;
            color: #2b2b2b;
        }

        .form-control {
            padding: 13px;
            border-radius: 12px;
            border: 1px solid #ddd;
        }

        .form-control:focus {
            border-color: #0fb9b1;
            box-shadow: 0 0 0 2px rgba(15, 185, 177, 0.25);
        }

        .primary-btn {
            background: linear-gradient(135deg, #0fb9b1, #3ddbd9);
            color: #fff;
            border: none;
            border-radius: 14px;
            padding: 14px;
            font-size: 16px;
            font-weight: 600;
            width: 100%;
            margin-top: 12px;
        }

        .secondary-btn {
            background: #f1f1f1;
            border: none;
            border-radius: 14px;
            padding: 14px;
            width: 100%;
            margin-top: 10px;
        }

        .stage {
            display: none;
        }

        .stage.active {
            display: block;
        }

        .form-control-wrapper {
            position: relative;
        }

        .password-eye {
            position: absolute;
            right: 14px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
        }
    </style>
</head>

<body>

<div class="auth-card">

    <img src="logo.png" class="logo" alt="CivicConnect Logo">

    <h3>Create an Account</h3>
    <p class="subtitle">Join CivicConnect and start making an impact.</p>

    <form id="registrationForm">

        <!-- STAGE 1 -->
        <div id="stage1" class="stage active">
            <label class="form-label">Register As</label>
            <select class="form-control" id="role" required>
                <option value="">Select Role</option>
                <option value="Volunteer">Volunteer</option>
                <option value="NGO">NGO</option>
            </select>

            <button type="button" class="primary-btn" onclick="nextStage(2)">Next</button>
        </div>

        <!-- STAGE 2 -->
        <div id="stage2" class="stage">
            <label class="form-label">Full Name</label>
            <input type="text" class="form-control mb-2" id="name" required>

            <label class="form-label">Email</label>
            <input type="email" class="form-control mb-2" id="email" required>

            <label class="form-label">Password</label>
            <div class="form-control-wrapper mb-2">
                <input type="password" class="form-control" id="password" required>
                <span class="password-eye" onclick="togglePasswordVisibility()">üëÅ</span>
            </div>

            <label class="form-label">Confirm Password</label>
            <input type="password" class="form-control" id="confirmPassword" required>

            <button type="button" class="secondary-btn" onclick="prevStage(1)">Back</button>
            <button type="button" class="primary-btn" onclick="nextStage(3)">Next</button>
        </div>

        <!-- STAGE 3 -->
        <div id="stage3" class="stage">

            <!-- Volunteer -->
            <div id="volunteerFields">
                <label class="form-label">Date of Birth</label>
                <input type="date" class="form-control mb-2" id="dob">

                <label class="form-label">City</label>
                <input type="text" class="form-control mb-2" id="city">

                <label class="form-label">Phone</label>
                <input type="tel" class="form-control mb-2" id="phone">

                <label class="form-label">Skills</label>
                <textarea class="form-control mb-2" id="skills"></textarea>
            </div>

            <!-- NGO -->
            <div id="ngoFields">
                <label class="form-label">NGO Name</label>
                <input type="text" class="form-control mb-2" id="ngoName">

                <label class="form-label">NGO Description</label>
                <textarea class="form-control mb-2" id="ngoDescription"></textarea>

                <label class="form-label">NGO Address</label>
                <input type="text" class="form-control mb-2" id="ngoAddress">
            </div>

            <button type="button" class="secondary-btn" onclick="prevStage(2)">Back</button>
            <button type="submit" class="primary-btn">Create Account</button>
        </div>

    </form>
</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        showStage(1);
    });

    function showStage(stage) {
        document.querySelectorAll('.stage').forEach(s => {
            s.classList.remove('active');
        });
        document.getElementById(`stage${stage}`).classList.add('active');
        updateRoleFields();
    }

    function nextStage(stage) {
        showStage(stage);
    }

    function prevStage(stage) {
        showStage(stage);
    }

    function updateRoleFields() {
        const role = document.getElementById('role').value;
        document.getElementById('volunteerFields').style.display = role === 'Volunteer' ? 'block' : 'none';
        document.getElementById('ngoFields').style.display = role === 'NGO' ? 'block' : 'none';
    }

    document.getElementById('role').addEventListener('change', updateRoleFields);

    function togglePasswordVisibility() {
        ['password', 'confirmPassword'].forEach(id => {
            const field = document.getElementById(id);
            field.type = field.type === "password" ? "text" : "password";
        });
    }

    document.getElementById("registrationForm").addEventListener("submit", async function (event) {
        event.preventDefault();

        const password = document.getElementById('password').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const role = document.getElementById('role').value;

        const passwordRegex = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}$/;
        if (!passwordRegex.test(password)) {
            alert("Password must contain 8+ chars, uppercase, lowercase, and number.");
            return;
        }

        if (password !== confirmPassword) {
            alert("Passwords do not match.");
            return;
        }

        if (!role) {
            alert("Please select a role.");
            return;
        }

        const formData = {
            name: document.getElementById('name').value,
            email: document.getElementById('email').value,
            password,
            role
        };

        if (role === 'Volunteer') {
            formData.volunteer = {
                dob: document.getElementById('dob').value,
                city: document.getElementById('city').value,
                phone: document.getElementById('phone').value || null,
                skills: document.getElementById('skills').value || null
            };
        } else {
            formData.ngo = {
                name: document.getElementById('ngoName').value,
                description: document.getElementById('ngoDescription').value,
                address: document.getElementById('ngoAddress').value
            };
        }

        try {
            const response = await fetch('/api/register', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(formData)
            });

            if (!response.ok) throw new Error("Registration failed");

            alert("Registration successful!");
            window.location.href = "login.html";
        } catch (error) {
            alert(error.message);
        }
    });
</script>

</body>
</html>
